<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="XAUMobile.AchievementsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:XAUMobile.Controls"
    xmlns:local="clr-namespace:XAUMobile"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Shell.NavBarIsVisible="true">

    <Shell.TitleView>
        <StackLayout HorizontalOptions="Start" Orientation="Horizontal">
            <ImageButton
                Margin="0,0,10,0"
                Clicked="OnFilterClicked"
                HeightRequest="25"
                HorizontalOptions="Start"
                Source="filter50.png"
                WidthRequest="25" />
            <!--  beta - still needs to be test before i enable and release  -->
            <!--<ImageButton
                Margin="0,0,10,0"
                Clicked="OnBulkUnlockClicked"
                HeightRequest="25"
                HorizontalOptions="Start"
                Source="padlock48.png"
                WidthRequest="25" />-->
        </StackLayout>
    </Shell.TitleView>
    <AbsoluteLayout>
        <StackLayout
            Padding="10"
            AbsoluteLayout.LayoutBounds="0, 0, 1, 1"
            AbsoluteLayout.LayoutFlags="All"
            Spacing="10">

            <Label
                x:Name="NoAchievementsLabel"
                FontSize="Medium"
                HorizontalOptions="Center"
                HorizontalTextAlignment="Center"
                IsVisible="False"
                Text="{local:Translate NoAchievementsFound}"
                TextColor="{DynamicResource Primary}"
                VerticalOptions="Center" />

            <!--  Achievements List  -->
            <ListView
                x:Name="AchievementsListView"
                Margin="8,0"
                BackgroundColor="Transparent"
                HasUnevenRows="True"
                ItemsSource="{Binding FilteredAchievements}"
                SelectionMode="None"
                SeparatorVisibility="None"
                VerticalOptions="FillAndExpand">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <SwipeView x:Name="achievementSwipeView" IsEnabled="{Binding IsSwipeEnabled}">
                                <SwipeView.RightItems>
                                    <SwipeItems>
                                        <SwipeItem
                                            BackgroundColor="{DynamicResource Primary}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type local:AchievementsPage}}, Path=UnlockCommand}"
                                            CommandParameter="{Binding .}"
                                            IconImageSource="padlock48.png" />
                                    </SwipeItems>
                                </SwipeView.RightItems>

                                <Frame
                                    Margin="4,3"
                                    Padding="0"
                                    BackgroundColor="{DynamicResource CardBg}"
                                    BorderColor="Transparent"
                                    CornerRadius="8"
                                    HasShadow="True">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer CommandParameter="{Binding Source={RelativeSource AncestorType={x:Type SwipeView}}, Path=.}" Tapped="OnAchievementTapped" />
                                    </Frame.GestureRecognizers>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="3" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <!--  Status Indicator  -->
                                        <BoxView Grid.Column="0">
                                            <BoxView.Triggers>
                                                <DataTrigger
                                                    Binding="{Binding ProgressState}"
                                                    TargetType="BoxView"
                                                    Value="NotStarted">
                                                    <Setter Property="IsVisible" Value="True" />
                                                    <Setter Property="Color" Value="{DynamicResource Primary}" />
                                                </DataTrigger>
                                                <DataTrigger
                                                    Binding="{Binding ProgressState}"
                                                    TargetType="BoxView"
                                                    Value="InProgress">
                                                    <Setter Property="IsVisible" Value="True" />
                                                    <Setter Property="Color" Value="{DynamicResource Primary}" />
                                                </DataTrigger>
                                                <DataTrigger
                                                    Binding="{Binding ProgressState}"
                                                    TargetType="BoxView"
                                                    Value="Achieved">
                                                    <Setter Property="IsVisible" Value="False" />
                                                </DataTrigger>
                                            </BoxView.Triggers>
                                        </BoxView>

                                        <!--  Content  -->
                                        <Grid Grid.Column="1" Padding="8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <!--  ID & Name  -->
                                            <StackLayout
                                                Grid.Row="0"
                                                Orientation="Horizontal"
                                                Spacing="6">
                                                <Label
                                                    FontSize="Small"
                                                    Text="{Binding Id, StringFormat='{}{0}|'}"
                                                    TextColor="{StaticResource Secondary}"
                                                    VerticalOptions="Center" />
                                                <Label
                                                    FontAttributes="Bold"
                                                    FontSize="Small"
                                                    Text="{Binding Name}"
                                                    TextColor="{DynamicResource Primary}"
                                                    VerticalOptions="Center" />
                                            </StackLayout>

                                            <!--  Description  -->
                                            <Label
                                                Grid.Row="1"
                                                Margin="0,4,0,2"
                                                FontSize="Small"
                                                Text="{Binding Description}"
                                                TextColor="{StaticResource Secondary}" />

                                            <!--  Time Unlocked  -->
                                            <Label
                                                Grid.Row="2"
                                                Margin="0,0,0,4"
                                                FontSize="Small"
                                                Text="{Binding TimeUnlocked, StringFormat='{local:Translate UnlockDate}: {0}'}"
                                                TextColor="{StaticResource Secondary}" />

                                            <!--  Misc Data  -->
                                            <StackLayout
                                                Grid.Row="3"
                                                Orientation="Horizontal"
                                                Spacing="6">
                                                <Image
                                                    Aspect="AspectFit"
                                                    HeightRequest="14"
                                                    Source="gs.png"
                                                    WidthRequest="14" />
                                                <Label
                                                    FontSize="Small"
                                                    Text="{Binding GSValue}"
                                                    TextColor="{StaticResource Secondary}"
                                                    VerticalOptions="Center" />
                                                <Image
                                                    Aspect="AspectFit"
                                                    HeightRequest="14"
                                                    Source="diamond.png"
                                                    WidthRequest="14" />
                                                <Label
                                                    FontSize="Small"
                                                    Text="{Binding CurrentPercentage, StringFormat='{}{0}%'}"
                                                    TextColor="{StaticResource Secondary}"
                                                    VerticalOptions="Center" />
                                                <Label
                                                    FontSize="Small"
                                                    Text="{Binding CurrentCategory}"
                                                    TextColor="{StaticResource Secondary}"
                                                    VerticalOptions="Center" />
                                            </StackLayout>
                                        </Grid>
                                    </Grid>
                                </Frame>
                            </SwipeView>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackLayout>

        <ActivityIndicator
            x:Name="AchievementsIndicator"
            AbsoluteLayout.LayoutBounds="0.5, 0.5, AutoSize, AutoSize"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            IsRunning="false"
            IsVisible="false"
            Color="{DynamicResource Primary}" />

        <controls:CallToAction
            x:Name="CallToActionControl"
            AbsoluteLayout.LayoutBounds="0, 0, 1, 1"
            AbsoluteLayout.LayoutFlags="All"
            IsVisible="False" />
    </AbsoluteLayout>
</ContentPage>